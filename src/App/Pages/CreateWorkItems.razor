@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@page "/createworkitems"

@using System.Diagnostics.CodeAnalysis;
@using Develix.AzureDevOps.Connector.App.Store.CreateWorkItemPageUseCase;
@using Develix.AzureDevOps.Connector.Model;

<PageTitle>Work Items</PageTitle>

<MudPaper Elevation="2" Class="pa-4 ma-3">
    <MudText Typo="Typo.h4">Work Items</MudText>

    <MudSelect T="WorkItemType" Dense="true" @bind-Value="workItemType">
        @foreach(var wit in state.Value.WorkItemTypes)
        {
            <MudSelectItem Value="@wit"><MudImage Style="height: 1em" Src="@(wit.Icon?.AbsoluteUri)" /> @wit.Name</MudSelectItem>
        }
    </MudSelect>

    <MudButton OnClick="GetWorkItemTypes">Get WI Types</MudButton>
    <MudButton OnClick="CreateWorkItem">Create work item</MudButton>
</MudPaper>

@code {
    [Inject]
    [NotNull]
    private IDispatcher? dispatcher { get; set; }

    [Inject]
    [NotNull]
    private IState<CreateWorkItemPageState>? state { get; set; }

    private WorkItemType? workItemType;

    private void CreateWorkItem()
    {
        if (workItemType is null)
            return;
        var action = new CreateWorkItemAction(workItemType.Name);
        dispatcher.Dispatch(action);
    }

    private void GetWorkItemTypes()
    {
        var action = new GetWorkItemTypesAction("Testproject");
        dispatcher.Dispatch(action);
    }
}
